"use strict";function MentionDetailView(a){var b=$(a).attr("id");$("#mention_text").html($("#mention_full_text"+b).text()),$("#mention_link").attr("href",$("#mention_link_list"+b).attr("href"))}function TodoDetailView(a){var b=$(a).attr("id");$("#detail_comment").html($("#todo_detail"+b).html())}function setRangeDisplay(a){var b=$("#current_date").text(),c=null,d=null,e=null,f=null,g=$("#toggle_period .active").data("period"),h="DD MM YY",i="MMM DD, YYYY",j=moment(b,h),k={week:{label:"isoweek",range:"days",count:7},month:{label:"month",range:"months",count:1}};return j.isValid()||["week","month"].indexOf(g)>=0?(c=j.clone().startOf(k[g].label),d=j.clone().endOf(k[g].label),e=c.clone().subtract(k[g].count,k[g].range),f=d.clone().add(k[g].count,k[g].range),$("#date_toggle [data-direction=prev]").attr("data-date",e.format(h)),$("#date_toggle [data-direction=next]").attr("data-date",f.format(h)),$("#date_range").html(c.format(i)+" - "+d.format(i)),"undefined"!=typeof a&&a(),!1):!1}var CONFIG={BASE:"/",get MERCHANT_MANAGER(){return this.BASE+String("merchant/")},get TODO_MANAGER(){return this.BASE+String("todo/")},get USER_MANAGER(){return this.BASE+String("users/")},get ISO_MANAGER(){return this.BASE},get ISO_WIDGETS_MANAGER(){return this.ISO_MANAGER},get ISO_TRACKER_MANAGER(){return this.ISO_MANAGER+String("tracker/")},get ISO_STATISTICS(){return this.ISO_MANAGER+String("statistics/")},MAX_LABEL_LENGTH:30},AJAX=function(a,b,c,d){function e(a){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(a)}function f(a){var b=document.location.host,c=document.location.protocol,d="//"+b,e=c+d;return a===e||a.slice(0,e.length+1)===e+"/"||a===d||a.slice(0,d.length+1)===d+"/"||!/^(\/\/|http:|https:).*/.test(a)}var g={};return g.createMerchant=function(b){return a.ajax({url:d.MERCHANT_MANAGER+"new",type:"POST",data:b,dataType:"json"})},g.updateMerchant=function(b){return a.ajax({url:d.MERCHANT_MANAGER+b.id+"/update",type:"POST",data:b,dataType:"json"})},g.createUserForMerchant=function(b){return a.ajax({url:d.USER_MANAGER+"create_user",type:"POST",data:b,dataType:"json"})},g.getMentionsForMerchant=function(b,c,e){var f={};return f.mention_status=c?c:"all",f.page=e?e:1,a.ajax({url:d.MERCHANT_MANAGER+b+"/mentions",type:"GET",data:f})},g.getTodosForMerchant=function(b,c,e){var f={};return f.status=c?c:"all",f.todo=e?e:1,a.ajax({url:d.MERCHANT_MANAGER+b+"/todos",type:"GET",data:f})},g.toggleTodoStatus=function(b){return a.ajax({url:d.TODO_MANAGER+b+"/toggle_status",type:"GET"})},g.createTodoForMention=function(b){return a.ajax({url:d.MERCHANT_MANAGER+"addtodo",type:"POST",data:b,dataType:"json"})},g.mentionFlagToggle=function(b){var c={};return a.ajax({url:String(d.MERCHANT_MANAGER+b.merchantId+"/mentions/"+b.mentionUId),type:"GET",data:c,dataType:"json"})},g.getDataForIndustriesComplaintsChart=function(b){var c=b||{};return a.ajax({url:d.ISO_WIDGETS_MANAGER+"industry_complaints_chart",type:"GET",data:c,dataType:"json"})},g.getDataForPerfomanceTrackingChart=function(b){var c=b||{};return a.ajax({url:d.ISO_WIDGETS_MANAGER+"score",type:"GET",data:c,dataType:"json"})},g.getDataForMentionsChart=function(b){var c=b||{};return a.ajax({url:d.ISO_WIDGETS_MANAGER+"iso_mention_chart",type:"GET",data:c,dataType:"json"})},g.getLowestRankedMerchants=function(b){var c=b||{};return a.ajax({url:d.ISO_WIDGETS_MANAGER+"lowest_ranked",type:"GET",data:c})},g.getComplaintsForISO=function(b){var c=b||{};return a.ajax({url:d.ISO_WIDGETS_MANAGER+"complaints",type:"GET",data:c})},g.getDataForResponseRateChart=function(b){var c=b||{};return a.ajax({url:d.ISO_WIDGETS_MANAGER+"response_rate_iso",type:"GET",data:c})},g.getDataForMerchantResponseRateChart=function(b){var c=b||{};return a.ajax({url:d.ISO_WIDGETS_MANAGER+"response_rate_merchant",type:"GET",data:c})},g.getDataForSolvedUnsolvedWidget=function(b){var c=b||{};return a.ajax({url:d.ISO_WIDGETS_MANAGER+"solved",type:"GET",data:c})},g.getDataForBigFiveWidget=function(b){var c=b||{};return a.ajax({url:d.ISO_WIDGETS_MANAGER+"big_five",type:"GET",data:c})},g.getMentionsForTracker=function(b,c){var e=c||{};return e.page=e.page||1,a.ajax({url:d.ISO_TRACKER_MANAGER+b+"/mentions",type:"GET",data:e})},g.getDataForComplaintsBySourceChart=function(b){var c=b||{};return a.ajax({url:d.ISO_STATISTICS+"by_source",type:"GET",data:c})},g.getDataForComplaintsOverTimeChart=function(b){var c=b||{};return a.ajax({url:d.ISO_STATISTICS+"by_time",type:"GET",data:c})},g.init=function(){a.ajaxSetup({beforeSend:function(a,b){var d=c.get("csrftoken");!e(b.type)&&f(b.url)&&a.setRequestHeader("X-CSRFToken",d)}})},g}($,_,Cookies,CONFIG);AJAX.init();var Popover=function(a){var b={};return b.open=function(b,c,d){a(b).popover({html:!0,placement:c,trigger:"manual",content:function(){return a(this).closest(".block-buttons").find(d).html()}}),a(b).popover("show")},b.close=function(b){a(b).popover("destroy")},b}($),APP=function(a,b,c){var d={};return d.msg={show:function(a){c[a.TYPE](a.MESSAGE)},success:function(a){this.show({TYPE:"success",MESSAGE:a})},error:function(a){this.show({TYPE:"error",MESSAGE:a})}},d.spinner={show:function(a){a.addClass("waiting")},hide:function(a){a.removeClass("waiting")},toggle:function(a){var b=a.find(".waitable");b.hasClass("waiting")?this.hide(b):this.show(b)}},d.getFilterParams=function(){var b=a("#merchant_search").val(),c=keywords.filter(function(a){return a.value===b})[0],d="",e="";return c&&(d=c.type,e=c.query),{filter:e,keywordType:d,date:a("#current_date").html(),period:a("#toggle_period").children(".active").data("period")}},d.showMessages=function(){var c=a(".alert"),e=5;c.length>e||b.each(c,function(b,c){d.msg.success(a("#message"+c).text().trim())})},d.init=function(){var e=5;b.templateSettings={interpolate:/\{(.+?)\}/g},c.logPosition("top right"),c.maxLogItems(e),d.showMessages(),a.widget("custom.customAutoComplete",a.ui.autocomplete,{_create:function(){this._super(),this.widget().menu("option","items","> :not(.ui-autocomplete-type)")},_renderItem:function(b,c){return a("<li></li>").data("item.autocomplete",c).append("<a>"+c.label+"</a>").appendTo(b)}}),a(function(){a('[data-toggle="tooltip"]').tooltip()})},d}($,_,alertify);APP.init();var CHARTS=function(a,b,c){var d={},e={};return d.buildPerformanceTrackerChart=function(d,f){var g=a("#tracking"),h={labels:f,datasets:[]},i={elements:{point:{radius:3}},legend:{position:"bottom",fullWidth:!0,labels:{boxWidth:12,padding:5}},scales:{xAxes:[{gridLines:{display:!1}}]}};b.each(d,function(a){h.datasets.push({label:TOOLS.truncatechars(a.label,CONFIG.MAX_LABEL_LENGTH),data:a.data,borderColor:a.color,borderWidth:2,backgroundColor:a.color,tension:0,fill:!1})}),"chartTracking"in e&&e.chartTracking.destroy(),e.chartTracking=new c(g,{type:"line",data:h,options:i})},d.buildMentionsChart=function(b,d,f,g){var h=a("#mentions"),i={labels:g,datasets:[{label:"Pos",borderColor:"#0fb474",pointColor:"#0fb474",data:d,borderWidth:2,backgroundColor:"#0fb474",tension:0,fill:!1},{label:"Neg",borderColor:"#d0021b",pointColor:"#d0021b",data:b,borderWidth:2,backgroundColor:"#d0021b",tension:0,fill:!1},{label:"Neutral",borderColor:"#d1ddea",pointColor:"#d1ddea",data:f,borderWidth:2,backgroundColor:"#d1ddea",tension:0,fill:!1}]},j={elements:{point:{radius:3}},legend:{position:"bottom",fullWidth:!0,labels:{boxWidth:12,padding:5}},scales:{xAxes:[{gridLines:{display:!1}}]}};"mentionsChart"in e&&e.mentionsChart.destroy(),e.mentionsChart=new c(h,{type:"line",data:i,options:j})},d.buildMerchantMentionsChart=function(b,d,f){var g=a("#mentions"),h=7,i={labels:Array(h),datasets:[{label:"Pos",borderColor:"#0fb474",pointColor:"#0fb474",data:d,tension:0,borderWidth:2,backgroundColor:"#0fb474",fill:!1},{label:"Neg",borderColor:"#d0021b",pointColor:"#d0021b",data:b,tension:0,borderWidth:2,backgroundColor:"#d0021b",fill:!1},{label:"Neutral",borderColor:"#d1ddea",pointColor:"#d1ddea",data:f,tension:0,borderWidth:2,backgroundColor:"#d1ddea",fill:!1}]},j={scales:{xAxes:[{display:!1}],yAxes:[{display:!1}]},legend:{position:"top",fullWidth:!0,labels:{boxWidth:12,padding:5}}};"merchantMentionsChart"in e&&e.merchantMentionsChart.destroy(),e.merchantMentionsChart=new c(g,{type:"line",data:i,options:j})},d.buildResponseRateChart=function(a,b,d){var f=a.find("canvas"),g={labels:["solved","unsolved"],datasets:[{data:[b,d],backgroundColor:["#0fb474","#d0021b"]}]},h={cutoutPercentage:80,legend:{display:!1},tooltips:{enabled:!1}};"responseRate"in e&&e.responseRate.destroy(),e.responseRate=new c(f,{type:"doughnut",data:g,options:h,animation:{animateScale:!0}})},d.buildIndustriesComplaintsChart=function(a,d,f){var g=a.find("canvas"),h=b.template("Neg.: { neg } ({ perc }%)"),i=a.find(".no-data-message");i[(d.length?"add":"remove")+"Class"]("hidden"),"industriesComplaints"in e&&e.industriesComplaints.destroy(),e.industriesComplaints=new c(g,{type:"pie",data:{labels:d,datasets:[{data:f.data,backgroundColor:f.backgroundColor}]},options:{cutoutPercentage:30,legend:{display:!1},tooltips:{callbacks:{title:function(a){return TOOLS.truncatechars(d[a[0].index],CONFIG.MAX_LABEL_LENGTH)},label:function(a){return h({neg:f.data[a.index],perc:Math.round(f.extData[a.index])})}}}}})},d.buildSparklineChart=function(a,b){var d=a.find("canvas"),f={legend:{display:!1},tooltips:{enabled:!1},elements:{point:{radius:0}},scales:{lineTension:0,xAxes:[{display:!1}],yAxes:[{display:!1}]}};e.sparklineCharts=e.sparklineCharts||[],e.sparklineCharts.push(new c(d,{type:"line",data:{labels:Array(b.length),datasets:[{data:b}]},options:f}))},d.buildComplaintsBySourceChart=function(a,b,d){var f=a.find("canvas"),g=b||0;"complaintsBySourceChart"+g in e&&e["complaintsBySourceChart"+g].destroy(),e["complaintsBySourceChart"+g]=new c(f,{type:"bar",data:{labels:d.labels,datasets:[{label:"Merchant/Industry",backgroundColor:"rgba(26, 115, 105, 1)",borderColor:"rgba(26, 115, 105, 1)",borderWidth:1,hoverBackgroundColor:"rgba(26, 115, 105, .8)",hoverBorderColor:"rgba(26, 115, 105, .8)",data:d.merchant},{label:"Average",backgroundColor:"rgba(121, 229, 210, 1)",borderColor:"rgba(121, 229, 210, 1)",borderWidth:1,hoverBackgroundColor:"rgba(121, 229, 210, .8)",hoverBorderColor:"rgba(121, 229, 210, .8)",data:d.average}]},options:{legend:{display:!1}}})},d.buildComplaintsOverTimeChart=function(a,d,f){var g=a.find("canvas"),h=d||0,i=[];"complaintsOverTimeChart"+h in e&&e["complaintsOverTimeChart"+h].destroy(),b.each(f.datasets,function(a){i.push({label:a.label,data:a.data,borderColor:a.color,backgroundColor:a.color,fill:!1,lineTension:0,borderWidth:2})}),e["complaintsOverTimeChart"+h]=new c(g,{type:"line",data:{labels:f.legend,datasets:i},options:{elements:{point:{radius:3}},legend:{position:"bottom",labels:{boxWidth:12,padding:5}},scales:{xAxes:[{gridLines:{display:!1}}]}}})},d.getCharts=function(){return e},d}($,_,Chart),EVENTS=function(){var a={},b={},c=b.hasOwnProperty;return a.subscribe=function(a,d){c.call(b,a)||(b[a]=[]);var e=b[a].push(d)-1;return{remove:function(){delete b[a][e]}}},a.publish=function(a,d){c.call(b,a)&&b[a].forEach(function(a){a(void 0!==d?d:{})})},a}(),FORM=function(a,b){var c={};return c.errorTemplate=b.template('<span class="help-block error"><strong>{ text }</strong></span>'),c.clearErrors=function(a){a.find(".has-error").removeClass("has-error"),a.find(".error").remove()},c.clearForm=function(a){a.clearForm(),c.clearErrors(a)},c.insertErrors=function(b,d){c.clearErrors(b),a.each(a.parseJSON(d.responseText),function(a,d){b.find("#div_id_"+a).append(c.errorTemplate({text:d})).addClass("has-error")})},c.getSearchSettings=function(a){var b={official_name:[!1],short_name:[!1,!1,!1],product:[!1,!1,!1]},c=a.find("#id_search_settings").val()||"null",d=JSON.parse(c),e=Boolean(d&&!("null"===d));return e?d:b},c.collectSearchSettings=function(d,e){var f={},g=[],h=null,i=!1,j=d.find("#id_search_settings"),k=e||c.getSearchSettings(d);b.each(k,function(c,d){f[d]=[],g=a("#div_id_"+d).find(".form-control"),b.each(g,function(b){h=a(b).attr("id"),a("#"+h).val().trim()&&(i=a("[data-target="+h+"]").is(":checked"),f[d].push(i))})}),j.val(JSON.stringify(f))},c.addCheckboxes=function(d){var e=null,f="",g=c.getSearchSettings(d),h=null,i=null;b.each(g,function(c,d){h=a("#div_id_"+d).find(".form-control"),b.each(h,function(b,c){f=g[d][c]?'checked="checked"':"",i=a(b).attr("id"),e=String('<div class="checkbox checkbox-custom"><label><input '+f+'type="checkbox" data-target="'+i+'"/> strict search</label></div>'),a(e).insertAfter("#"+i)})})},c}($,_),TOOLS=function(){var a={};return a.truncatechars=function(a,b){var c=24,d=b?b:c;return a.length>d?a.substr(0,d)+"...":a},a.unescapeUnicode=function(a){return unescape(a.toString().replace(/\\u([\d\w]{4})/gi,function(a,b){return String.fromCharCode(parseInt(b,16))}))},a.randomArray=function(a,b){var c=10,d=100,e="undefined"!=typeof a?a:c,f="undefined"!=typeof b?b:d;return Array.apply(Object,Array(e)).map(function(){return Math.round(Math.random()*f)})},a.getRandomColor=function(){var a=16,b=2,c=8;return"#"+Math.random().toString(a).slice(b,c)},a.getRandomColors=function(b){return Array.apply(Object,Array(b)).map(function(){return a.getRandomColor()})},a}(),Tracker=function(a,b){function c(a,c,d,e){var f=e.closest(".tracker"),g=b.template('<a href="{ url }">{ title }</a>');e.find(".error").remove(),f.find(".panel-heading > h4").html(g({url:a.url,title:a.merchant})),f.attr("data-id",a.pk),Tracker.closeSettings(),Tracker.getMentions(a.pk,1)}function d(c){var d=a("#tracker_add_id"),e=b.template('<span class="help-block error"><strong>{ text }</strong></span>');d.find(".help-block.error").remove(),a.each(a.parseJSON(c.responseText),function(b,c){a(e({text:c})).insertAfter(d.find("#id_"+b)),d.find("#div_id_"+b).addClass("has-error")})}function e(b,c){var d=c,e={cache:!1};return b&&(e.url="/tracker/"+b+"/update",d=a.get(e)),d}var f={};return f.add=function(){var b=a(".panel.hidden").clone().removeClass("hidden");a(".block-horizontal-scroll").prepend(b),Tracker.closeSettings()},f.remove=function(b){var c=a(b).closest(".tracker");c.remove(),c.data("id")&&a.get("/tracker/"+c.data("id")+"/delete")},f.save=function(b){var e=a(b).parent(),f=a(b).closest(".tracker"),g=f.data("id")?f.data("id"):null,h=g?"/tracker/"+g+"/update":"/tracker/create",i={success:c,error:d,type:"POST",dataType:"json",url:h};e.ajaxSubmit(i)},f.toggleSettings=function(b){var c=a(b).closest(".tracker"),d=c.data("id")?c.data("id"):null,f=a(b).closest(".tracker").find(".form-wrapper").html();a(b).hasClass("has-popover")||(Tracker.closeSettings(),a.when(e(d,f)).done(function(c){a(b).popover({html:!0,placement:"bottom",trigger:"manual",content:function(){return c}}),a(b).addClass("has-popover"),a(b).popover("show")}))},f.closeSettings=function(){a(".tracker").find(".settings.has-popover").removeClass("has-popover"),a(".tracker").find(".popover").popover("destroy")},f.getMentions=function(b,c){var d=null,e=a(".tracker[data-id="+b+"]"),f="tracker/"+b+"/mentions?page="+c;1===parseInt(c,10)&&e.find(".list-group-item").remove(),a.get(f,function(a){d=a,d||(d='<div class="list-group-item text-center note">No results</div>'),e.find(".list-group").append(d),e.attr("data-page",c)})},f.scrollListener=function(b){var c=a(b).closest(".tracker"),d=c.find(".list-group").height()-a(b).height(),e=parseInt(c.attr("data-page"),10);a(b).scrollTop()>=d&&Tracker.getMentions(c.data("id"),e+1)},f}($,_);
//# sourceMappingURL=app.min.js.map